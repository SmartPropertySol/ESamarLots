<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOT FOR SALE - SMART Property Solutions</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/css/lightbox.min.css" />
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        #map {
            height: calc(100vh - 70px);
            width: 100%;
        }
        .title {
            position: absolute;
            background: rgba(195, 243, 185, 0.8);
            padding: 5px;
            border-radius: 10px;
            top: 5px;
            left: 1520px;
            z-index: 500;
        }
        .logo-left {
            position: absolute;
            top: 10px;
            left: 50px;
            z-index: 1000;
            width: 150px;
        }
        .logo-right {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            width: 150px;
        }
        .center-message {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: rgba(233, 236, 46, 0.7);
            color: rgb(226, 9, 9);
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
        }
        
        /* Simple blinking animation */
        .blinking-marker {
            animation: blink 1s infinite;
        }
        
        .non-blinking-marker {
            animation: none;
            opacity: 1;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* Camera marker styles */
        .camera-marker {
            animation: blink 1s infinite;
            cursor: pointer;
            border-radius: 50%;
            background: rgba(52, 152, 219, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 0 rgba(52, 152, 219, 0.4);
            transition: all 0.3s ease;
        }
        
        .camera-marker img {
            width: 20px;
            height: 20px;
            filter: brightness(0) invert(1);
        }
        
        .camera-marker:hover {
            animation: none;
            transform: scale(1.3);
            background: rgba(41, 128, 185, 1);
            box-shadow: 0 0 20px rgba(52, 152, 219, 0.8);
        }
        
        /* Side Panel for Property Details - Now at bottom left */
        #propertyPanel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 350px;
            max-height: 60vh;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            padding: 15px;
            overflow-y: auto;
            display: none;
        }
        
        .panel-close {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #666;
        }
        
        .panel-close:hover {
            color: #000;
        }
        
        .property-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
            border-bottom: 2px solid #eee;
            padding-bottom: 8px;
        }
        
        .property-info {
            margin-bottom: 15px;
        }
        
        .property-info p {
            margin: 5px 0;
            font-size: 14px;
        }
        
        .property-images {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 15px;
        }
        
        .property-images img {
            width: 70px;
            height: 70px;
            object-fit: cover;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .property-videos {
            margin-bottom: 15px;
        }
        
        .video-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .video-btn:hover {
            background: #45a049;
        }
        
        .tour-btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 10px;
            width: 100%;
            justify-content: center;
        }
        
        .tour-btn:hover {
            background: #0b7dda;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.9);
        }
        .modal-content {
            margin: 5% auto;
            display: block;
            width: 80%;
            max-width: 1500px;
        }
        .modal-content iframe {
            width: 90%;
            height: 80vh;
        }
        .close {
            position: absolute;
            top: 15px;
            right: 35px;
            color: #fff;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .distance-label {
            background-color: white;
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
            line-height: 1.2;
        }

        /* Measurement label styles */
        .measurement-label {
            font-size: 12px;
            font-weight: bold;
            color: black;
            text-align: center;
            white-space: nowrap;
            background: white;
            padding: 2px 5px;
            border-radius: 5px;
            box-shadow: 1px 1px 3px rgba(0,0,0,0.3);
            pointer-events: none;
        }

        /* Custom blue pin with name */
        .blue-pin-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .blue-pin {
            width: 30px;
            height: 30px;
            background-color: #2196F3;
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        
        .blue-pin-inner {
            transform: rotate(45deg);
            color: white;
            font-weight: bold;
            font-size: 14px;
        }
        
        .blue-pin-name {
            background-color: rgba(33, 150, 243, 0.8);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
            white-space: nowrap;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        /* Light blue pin styles for unselected markers */
        .lightblue-pin .blue-pin {
            background-color: #87CEEB;
        }
        
        .lightblue-pin .blue-pin-name {
            background-color: rgba(135, 206, 235, 0.8);
        }
        
        /* Hover effect for light blue pins */
        .lightblue-pin:hover .blue-pin {
            background-color: #2196F3;
        }
        
        .lightblue-pin:hover .blue-pin-name {
            background-color: rgba(33, 150, 243, 0.8);
        }

        /* NEW ENHANCEMENT STYLES */
        
        /* Status badges */
        .status-available { 
            background: #4CAF50; 
            color: white; 
            padding: 2px 8px; 
            border-radius: 10px; 
            font-size: 12px; 
            font-weight: bold;
        }
        
        .status-sold { 
            background: #f44336; 
            color: white; 
            padding: 2px 8px; 
            border-radius: 10px; 
            font-size: 12px; 
        }
        
        .status-reserved { 
            background: #FF9800; 
            color: white; 
            padding: 2px 8px; 
            border-radius: 10px; 
            font-size: 12px; 
        }

        /* Highlight feature */
        .highlight-feature {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
        }

        .feature-badge {
            background: #FFD700;
            color: #333;
            padding: 3px 8px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
            margin: 2px;
            display: inline-block;
        }

        /* Featured properties panel */
        .featured-panel {
            position: absolute;
            top: 120px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 999;
            max-width: 250px;
        }

        .featured-panel h3 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 16px;
        }

        .featured-item {
            padding: 10px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid #2196F3;
            font-size: 12px;
        }

        .featured-item:hover {
            background: #e3f2fd;
            transform: translateX(5px);
        }

        /* Quick contact */
        .quick-contact {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .contact-btn {
            background: #25D366;
            color: white;
            padding: 15px 20px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(37, 211, 102, 0.4);
            font-weight: bold;
            text-align: center;
        }

        .contact-options {
            display: none;
            position: absolute;
            bottom: 60px;
            right: 0;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            overflow: hidden;
            min-width: 150px;
        }

        .contact-option {
            display: block;
            padding: 12px 20px;
            text-decoration: none;
            color: #333;
            border-bottom: 1px solid #eee;
            transition: background 0.3s ease;
        }

        .contact-option:hover {
            background: #f5f5f5;
        }

        /* Action buttons */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .action-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .action-btn.primary {
            background: #4CAF50;
            color: white;
        }

        .action-btn.secondary {
            background: #2196F3;
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        /* Urgency note */
        .urgency-note {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 10px;
            margin: 15px 0;
            text-align: center;
            color: #856404;
            font-size: 12px;
        }

        .property-features {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin: 10px 0;
        }

        .property-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>

<div class="title">
    <h2>LOT FOR SALE</h2>
    <h3>ERIK G. COSTUNA</h3>
    <p>Contact: 0956 4907947</p>
    <p><a href="https://www.facebook.com/EsamarRealtor" target="_blank">FB: SMART Property Solutions</a></p>
</div>

<!-- Logo on the top left -->
<img class="logo-left" src="https://github.com/SmartPropertySolutionsESamar/easternsamarlotforsale/blob/main/images/logo.png?raw=true" alt="Left Logo"> 
<!-- Logo on the top right -->
<img class="logo-right" src="https://github.com/SmartPropertySolutionsESamar/easternsamarlotforsale/blob/main/images/enrico.jpg?raw=true" alt="Right Logo">

<!-- Center Message -->
<div class="center-message">
    Click on the blue pins to see property data
</div>

<!-- Property Details Panel - Now at bottom left -->
<div id="propertyPanel">
    <button class="panel-close" onclick="closePropertyPanel()">√ó</button>
    <div id="panelContent"></div>
</div>

<!-- Featured Properties Panel -->
<div id="featuredProperties" class="featured-panel">
    <h3>üî• Featured Properties</h3>
    <div class="featured-list">
        <div class="featured-item" onclick="showPropertyPanel(markers[0].markerData)">
            <span class="feature-badge">BEST VALUE</span>
            LOT-001 - 350 sq.m. - P2500.00
        </div>
        <div class="featured-item" onclick="showPropertyPanel(markers[2].markerData)">
            <span class="feature-badge">NEAR CITY</span>
            LOT-003 - 200 sq.m. - P2500.00
        </div>
    </div>
</div>

<!-- Quick Contact Floating Button -->
<div id="quickContact" class="quick-contact">
    <div class="contact-btn" onclick="toggleContactOptions()">üìû Contact Agent</div>
    <div class="contact-options" id="contactOptions">
        <a href="tel:09564907947" class="contact-option">üìû Call Now</a>
        <a href="https://m.me/EsamarRealtor" class="contact-option" target="_blank">üí¨ Message</a>
        <a href="https://wa.me/639564907947" class="contact-option" target="_blank">üíö WhatsApp</a>
    </div>
</div>

<div id="map"></div>

<!-- Video modal -->
<div id="videoModal" class="modal">
    <span class="close">&times;</span>
    <div class="modal-content">
        <iframe id="videoFrame" src="" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
    </div>
</div>

<!-- 360¬∞ Photo Modal -->
<div id="panoramaModal" class="modal">
    <span class="close" onclick="closePanoramaModal()">&times;</span>
    <div class="modal-content">
        <div id="panorama"></div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/js/lightbox-plus-jquery.min.js"></script>
<script>
    // Initialize the Leaflet map centered on Borongan City
    var myMap = L.map('map').setView([11.6076, 125.4858], 13);

    // Satellite layer with 50% opacity
    var satelliteLayer = L.tileLayer('https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
        maxZoom: 20,
        opacity: 0.75,
        subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
    }).addTo(myMap);

    // Street view layer with 50% opacity
    var streetLayer = L.tileLayer('https://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {
        maxZoom: 20,
        opacity: 0.35,
        subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
    }).addTo(myMap);

    // Define polygons for each lot
    const lotPolygons = {
        "LOT-001": L.polygon([
            [11.629271346205456, 125.42047039078784],
            [11.629302545979314, 125.42052932004873],
            [11.629015507928486, 125.42067903222647],
            [11.629137187137914, 125.42085900537649],
            [11.629889101075776, 125.4205038371253],
            [11.6297736621393, 125.42021874691403],
            [11.629271346205456, 125.42047039078784]
        ], { color: 'red', fillOpacity: 0.3 }),
        
        "LOT-002": L.polygon([
            [11.626178134540083, 125.44287872399764],
            [11.625832695571319, 125.44273467383914],
            [11.625786474832424, 125.44292342918988],
            [11.626024876453812, 125.44298551976584],
            [11.626012713110555, 125.4430848646872],
            [11.6261367791858, 125.44311218454061],
            [11.626178134540083, 125.44287872399764]
        ], { color: 'purple', fillOpacity: 0.3 }),
        
        "LOT-003": L.polygon([
            [11.613804878939504,125.4309201952421],
            [11.613804878939504,125.43136465574008],
            [11.613875380645467,125.43136465574008],
            [11.613875380645467,125.4309201952421],
            [11.613804878939504,125.4309201952421]
        ], { color: 'red', fillOpacity: 0.3 }),
        
        "LOT-004": L.polygon([
            [11.620421865394633,125.43848391725538],
            [11.620320678053147,125.4384219344322],
            [11.62018508695897,125.43870498932671],
            [11.620294369339177,125.43876077386727],
            [11.620421865394633,125.43848391725538]
        ], { color: 'red', fillOpacity: 0.3 })
    };

    // Add all polygons to the map
    Object.values(lotPolygons).forEach(polygon => polygon.addTo(myMap));

    // Manual measurements for LOT-001
    var manualMeasurements = [
        { coords: [11.629861890572784, 125.42032987467235], text: "34m", angle: -25 },  
        { coords: [11.629546418165233, 125.42069010082798], text: "92m", angle: 60 }, 
        { coords: [11.629488304974686, 125.4203213988597], text: "62m", angle: 60 },
        { coords: [11.629152077182013, 125.42056508132919], text: "36m", angle: 60 },
        { coords: [11.629077375537577, 125.42078017938456], text: "24m", angle: -35 },
        { coords: [11.629741381458246, 125.4204016065899], text: "Land Area=2800sq.m.", angle: -25 },
        { coords: [11.62927199875051, 125.42049115846606], text: "7m", angle: -25 }
    ];

    let measurementMarkers = [];

    function addManualMeasurements(measurements) {
        measurements.forEach(measurement => {
            let labelMarker = L.marker(measurement.coords, { 
                icon: L.divIcon({
                    className: 'measurement-label',
                    html: `<span style="
                        background: white; 
                        padding: 2px 5px; 
                        border-radius: 3px; 
                        font-size: 12px; 
                        font-weight: bold; 
                        display: inline-block;
                        transform: rotate(${measurement.angle}deg);
                        transform-origin: center;
                    ">${measurement.text}</span>`,
                    iconSize: [0, 0], 
                    iconAnchor: [0, 0]
                })
            });
            measurementMarkers.push(labelMarker);
        });
    }

    function toggleManualMeasurements() {
        if (myMap.getZoom() >= 18) {
            measurementMarkers.forEach(marker => marker.addTo(myMap));
        } else {
            measurementMarkers.forEach(marker => myMap.removeLayer(marker));
        }
    }

    // Camera pin data for 360¬∞ photos
    const lot360Photos = {
        "LOT-001": [ // Lot 001
            {
                coords: [11.629163221507852, 125.42075509397085],
                photoUrl: "https://embed.panorra.com/view/xa240aca751-2025022028032152?stage=live"
            },
            {
                coords: [11.62935846548443, 125.42054374413789],
                photoUrl: "https://embed.panorra.com/view/qac3fc51a83-2025022028033322?stage=live"
            },
            {
                coords: [11.629235747375546, 125.42060562507959],
                photoUrl: "https://embed.panorra.com/view/jb3fe1da222-2025022028042421?stage=live"
            },
            {
                coords: [11.629511114358834, 125.42047231363506],
                photoUrl: "https://embed.panorra.com/view/h5313368c6d-2025022028042624?stage=live"
            }
        ],
        "LOT-002": [ // Lot 002
            {
                coords: [11.625933649127134, 125.44303499995533],
                photoUrl: "https://embed.panorra.com/view/sample-photo-002"
            }
        ],
        "LOT-003": [ // Lot 003
            {
                coords: [11.61384054336672, 125.4312123618675],
                photoUrl: "https://renderstuff.com/tools/360-panorama-web-viewer-sharing/?image=https://i.imgur.com/Qmf4lnm.jpeg" 
            },
            {
                coords: [11.613808948692807, 125.43096061520981],
                photoUrl: "https://www.google.com/maps/embed?pb=!4v1740871373246!6m8!1m7!1sCAoSK0FGMVFpcE1OMXhCLVhpYlFBODlnV2RLY0lCX2NIX0xoTF83TThPQTZJdzA.!2m2!1d11.6137476!2d125.4308548!3f262.4358358258952!4f-10.446819415056396!5f0.7820865974627469"
            },
            {
                coords: [11.613841313967924, 125.43114470495277],
                photoUrl: "https://renderstuff.com/tools/360-panorama-web-viewer-embed/?image=https://i.ibb.co/KzpNhXJv/vir-tour-01.jpg"
            }
        ],
        "LOT-004": [ // Lot 004
            {
                coords: [11.620310559317474, 125.43859755243164],
                photoUrl: "https://embed.panorra.com/view/sample-photo-004"
            }
        ]
    };

    // Track active camera pins and markers
    let activeCameraPins = [];
    let propertyMarkers = [];
    
    // Track current zoom level and virtual tour state
    let currentZoomLevel = myMap.getZoom();
    let isVirtualTourActive = false;
    
    // Track the currently selected marker
    let selectedMarker = null;

    // Function to create blue pin with name
    function createBluePinWithName(lotTitle, isSelected = false) {
        const className = isSelected ? 'blue-pin-container' : 'blue-pin-container lightblue-pin';
        
        return L.divIcon({
            className: `blinking-marker ${className}`,
            html: `
                <div class="blue-pin">
                    <div class="blue-pin-inner">!</div>
                </div>
                <div class="blue-pin-name">${lotTitle}</div>
            `,
            iconSize: [80, 50],
            iconAnchor: [15, 50]
        });
    }

    function createCameraIcon() {
        return L.divIcon({
            className: 'camera-marker',
            html: `<img src="https://github.com/SmartPropertySolutionsESamar/easternsamarlotforsale/blob/main/images/360%20degree%20camera.png?raw=true" alt="360¬∞ Camera">`,
            iconSize: [32, 32],
            iconAnchor: [16, 16]
        });
    }

    function addCameraPins(lotTitle) {
        clearCameraPins();
        
        if (lot360Photos[lotTitle]) {
            lot360Photos[lotTitle].forEach(camera => {
                const cameraIcon = createCameraIcon();
                const pin = L.marker(camera.coords, { icon: cameraIcon }).addTo(myMap);
                activeCameraPins.push(pin);

                pin.bindTooltip("Click for 360¬∞ View", {
                    permanent: false,
                    direction: 'top',
                    className: 'camera-tooltip'
                });

                pin.on("click", () => {
                    openPanoramaModal(camera.photoUrl);
                });
            });
        }
        
        // Set virtual tour as active
        isVirtualTourActive = true;
    }

    function clearCameraPins() {
        activeCameraPins.forEach(pin => myMap.removeLayer(pin));
        activeCameraPins = [];
        
        // Set virtual tour as inactive
        isVirtualTourActive = false;
    }

    // Function to update marker appearance
    function updateMarkerAppearance(selectedMarkerData) {
        propertyMarkers.forEach(marker => {
            const isSelected = marker.markerData.title === selectedMarkerData.title;
            
            // Create new icon based on selection state
            const newIcon = createBluePinWithName(marker.markerData.title, isSelected);
            
            // Update the marker icon
            marker.setIcon(newIcon);
            
            // Update blinking state
            if (isSelected) {
                stopBlinking(marker.markerData.title);
            } else {
                // Keep other markers blinking
                var icon = marker.getElement();
                if (icon) {
                    icon.classList.remove('non-blinking-marker');
                    icon.classList.add('blinking-marker');
                }
            }
        });
    }

    // Function to stop blinking for a specific marker
    function stopBlinking(lotTitle) {
        propertyMarkers.forEach(marker => {
            if (marker.markerData.title === lotTitle) {
                var icon = marker.getElement();
                if (icon) {
                    icon.classList.remove('blinking-marker');
                    icon.classList.add('non-blinking-marker');
                }
            }
        });
    }

    // Function to reset all markers to blinking and light blue
    function resetAllMarkers() {
        propertyMarkers.forEach(marker => {
            // Reset to light blue pin
            const newIcon = createBluePinWithName(marker.markerData.title, false);
            marker.setIcon(newIcon);
            
            // Reset blinking
            var icon = marker.getElement();
            if (icon) {
                icon.classList.remove('non-blinking-marker');
                icon.classList.add('blinking-marker');
            }
        });
        selectedMarker = null;
    }

    // Define markers with exact coordinates and all routes
    var markers = [
        {
            coords: [11.629568637091609, 125.4204993711952],
            title: "LOT-001",
            location: "Brgy Surok, Borongan City",
            area: "350 sq.m.",
            cost: "P2500.00",
            images: [
                'https://i.imgur.com/lZrVJx7.png',
                'https://via.placeholder.com/150',
                'https://via.placeholder.com/150',
                'https://via.placeholder.com/150'
            ],
            videos: [
                'https://www.youtube.com/embed/SF3DgoJzkkw',
                'https://www.youtube.com/embed/WoNlC4ecuEk' 
            ],
            routes: [
                { 
                    coords: [[11.6290150071816,125.420714411133],[11.6291759427984,125.420929392315],[11.6292687260292,125.421074867073],[11.6293581955555,125.421338751559],[11.6294774882061,125.421524823965],[11.6295743024513,125.42163601411],[11.6296673363335,125.421678506859],[11.6300810919078,125.42170850174],[11.6307053988778,125.421765989423],[11.6320196006618,125.421781985867],[11.6324735764178,125.422851056459],[11.6325630449018,125.423165687902],[11.6326293178346,125.423524300091],[11.6326160632495,125.423808483333],[11.6325166536694,125.424136647915],[11.6321919135062,125.4249486004],[11.6319036256806,125.425628610305],[11.6317578248278,125.425902644147],[11.6316053965813,125.426115781579],[11.6314264589259,125.426602952998],[11.6313601833887,125.426863455278],[11.6313966336627,125.427130722858],[11.6315159254305,125.42744873744],[11.6316285898425,125.427790433983],[11.6316882357456,125.428179494514],[11.6318307217585,125.428683580366],[11.631860544659,125.429072640759],[11.6318075261778,125.429553045792],[11.6317478803824,125.430189075056],[11.6316981723029,125.430547691879],[11.6315291757299,125.430997648684],[11.6314629025351,125.431227701785],[11.6313734336973,125.431687807991],[11.6313336697608,125.431971991234],[11.6313469244069,125.43230353835],[11.6314463342345,125.432777177089],[11.631535802859,125.433338773792],[11.63156562579,125.433646638973],[11.63156562579,125.434177790987],[11.6314960389467,125.434658196195],[11.6313933122362,125.435260394231],[11.6312607657662,125.435784779978],[11.6309592223133,125.436194139172],[11.6308001662878,125.436454640508],[11.6306179144864,125.436857233437],[11.6303726975881,125.437398536120],[11.6301341130389,125.437933071292],[11.6300910352528,125.438119143678],[11.6300678395324,125.438379645102],[11.6299618018639,125.438816069440],[11.6298623915061,125.439093486415],[11.6296304288499,125.439506220641],[11.6293123152031,125.439807319559],[11.6287920660584,125.440335088440],[11.6280033996031,125.440974497748],[11.6274036190224,125.441509032904],[11.6267375626525,125.442016503496],[11.6264857200614,125.442114614443],[11.6263796792214,125.441955601576],[11.626104640274,125.441654502663],[11.6256208361633,125.441231610933],[11.6253027179207,125.440947427695],[11.6251469723908,125.440879765027],[11.6249282657749,125.440872998760],[11.6239043176719,125.440967724803],[11.6231984874365,125.441004938684],[11.6230062893786,125.440984639881],[11.6228107774225,125.440889912115],[11.6222938299053,125.440470403509],[11.6215482354431,125.439878359420],[11.6205772967649,125.439137453106],[11.6200238937686,125.438741626855],[11.6193677613402,125.438291670052],[11.6187315102384,125.437845096385],[11.6181383433656,125.437445892420],[11.6176644668932,125.437090663367],[11.6172502385481,125.436704986108],[11.6166868870111,125.436082489480],[11.6162560872379,125.435662979230],[11.6157291860139,125.435141976616],[11.615470706821,125.434922074960],[11.6147979943819,125.434553313370],[11.613999353369,125.434133804773],[11.613449250127,125.433866535689],[11.6126307219469,125.433501157233],[11.6124451443728,125.433416578886],[11.6118983526398,125.433152694387],[11.6110731921001,125.432821147271],[11.6105993037538,125.432635073807],[11.6102380875172,125.432523430390],[11.609837103807,125.432449001446],[11.6093466430259,125.432452383423],[11.6088230426638,125.432553877485],[11.6084253708483,125.432685819722],[11.6078354890368,125.432854974008]],
                    label: "5.28 km CITY CENTER", 
                    color: "black" 
                },
                { 
                    coords: [[11.611058774278959,125.43281758237293],[11.611408338540159,125.43191279769866]],
                    label: "4.93 km HOSPITAL", 
                    color: "black" 
                },
                { 
                    coords: [[11.612184886446585,125.43329698524644],[11.61209478030726,125.43350231763827]],
                    label: "4.72 km MetroBANK", 
                    color: "black" 
                },
                { 
                    coords: [[11.609223161168458,125.43247807940111],[11.610411464791468,125.43585648638344],[11.61095725374821,125.43762680001106]],
                    label: "4.72 km St.Mary's COLLEGE", 
                    color: "black" 
                },
                { 
                    coords: [[11.613463337308701,125.43387376112781],[11.613380360584685,125.4340792301565]], 
                    label: "4.64 km SAVEMORE", 
                    color: "black" 
                }
            ]
        },
        {
            coords: [11.6259776998738, 125.44289404488808],
            title: "LOT-002",
            location: "Brgy Sabang, Borongan City",
            area: "200 sq.m.",
            cost: "P2500.00",
            images: [
                'https://github.com/SmartPropertySolutionsESamar/easternsamarlotforsale/blob/main/images/pic1.png?raw=true',
                'https://github.com/SmartPropertySolutionsESamar/easternsamarlotforsale/blob/main/images/pic2.png?raw=true',
                'https://github.com/SmartPropertySolutionsESamar/easternsamarlotforsale/blob/main/images/pic3.png?raw=true',
                'https://github.com/SmartPropertySolutionsESamar/easternsamarlotforsale/blob/main/images/pic4.png?raw=true'
            ],
            videos: [
                'https://github.com/SmartPropertySolutionsESamar/easternsamarlotforsale/blob/main/images/github%20balud.mp4',
                'https://www.youtube.com/embed/WoNlC4ecuEk'
            ],
            routes: [
                { 
                    coords: [[11.6138320392987,125.430902101926],[11.6135038697128,125.430903584352],[11.613166261515,125.430947439031],[11.6127510665888,125.430974566962],[11.6123126197644,125.430994912815],[11.6117529346948,125.431052559279],[11.6114822261,125.431110205874],[11.6109275217777,125.431308577907],[11.6102897765266,125.431552728197],[11.6097533371024,125.431813832502],[11.6091537876692,125.432105456419],[11.6091023027541,125.432132584226],[11.6092052725738,125.432464899866],[11.6089345595133,125.432534408779],[11.6085907726925,125.432629356090],[11.6082586096292,125.432746342823],[11.6078234773642,125.432849767588],[11.6073999691028,125.432946409440],[11.6070777709978,125.433037965784]],
                    label: "0.83 km CITY CENTER", 
                    color: "black" 
                },
                { 
                    coords: [[11.611058774278959,125.43281758237293],[11.611408338540159,125.43191279769866]],
                    label: "4.93 km HOSPITAL", 
                    color: "black" 
                },
                { 
                    coords: [[11.612184886446585,125.43329698524644],[11.61209478030726,125.43350231763827]],
                    label: "4.72 km MetroBANK", 
                    color: "black" 
                },
                { 
                    coords: [[11.609223161168458,125.43247807940111],[11.610411464791468,125.43585648638344],[11.61095725374821,125.43762680001106]],
                    label: "4.72 km St.Mary's COLLEGE", 
                    color: "black" 
                },
                { 
                    coords: [[11.613463337308701,125.43387376112781],[11.613380360584685,125.4340792301565]], 
                    label: "4.64 km SAVEMORE", 
                    color: "black" 
                }
            ]
        },
        {
            coords: [11.613848864745037, 125.43110857043001],
            title: "LOT-003",
            location: "Brgy Balud, Borongan City",
            area: "200 sq.m.",
            cost: "P2500.00",
            images: [
                'https://github.com/SmartPropertySolutionsESamar/easternsamarlotforsale/blob/main/images/pic1.png?raw=true',
                'https://github.com/SmartPropertySolutionsESamar/easternsamarlotforsale/blob/main/images/pic2.png?raw=true',
                'https://github.com/SmartPropertySolutionsESamar/easternsamarlotforsale/blob/main/images/pic3.png?raw=true',
                'https://github.com/SmartPropertySolutionsESamar/easternsamarlotforsale/blob/main/images/pic4.png?raw=true'
            ],
            videos: [
                'https://www.youtube.com/embed/dQw4w9WgXcQ',
                'https://www.youtube.com/embed/3JZ_D3ELwOQ'
            ],
            routes: [
                { 
                    coords: [[11.6138320392987,125.430902101926],[11.6135038697128,125.430903584352],[11.613166261515,125.430947439031],[11.6127510665888,125.430974566962],[11.6123126197644,125.430994912815],[11.6117529346948,125.431052559279],[11.6114822261,125.431110205874],[11.6109275217777,125.431308577907],[11.6102897765266,125.431552728197],[11.6097533371024,125.431813832502],[11.6091537876692,125.432105456419],[11.6091023027541,125.432132584226],[11.6092052725738,125.432464899866],[11.6089345595133,125.432534408779],[11.6085907726925,125.432629356090],[11.6082586096292,125.432746342823],[11.6078234773642,125.432849767588],[11.6073999691028,125.432946409440],[11.6070777709978,125.433037965784]],
                    label: "0.83 km CITY CENTER", 
                    color: "black" 
                },
                { 
                    coords: [[11.6092052622285,125.432464898381],[11.6094427569903,125.43246659387],[11.6098230803488,125.432498808139],[11.6101357126716,125.432532535812],[11.6104529794108,125.432626691016],[11.6107075303699,125.432722729322],[11.6109915942101,125.432822533836],[11.6110561541331,125.432839481774],[11.61124061108,125.432378122805],[11.6114029329993,125.431941242665]],
                    label: "0.90 km HOSPITAL", 
                    color: "black" 
                },
                { 
                    coords: [[11.6110571053576,125.432840379724],[11.6116799178819,125.433100552971],[11.6121582696532,125.433309248347],[11.6121037566711,125.433448378425]],
                    label: "0.94 km MetroBANK", 
                    color: "black" 
                },
                { 
                    coords: [[11.609223161168458,125.43247807940111],[11.610411464791468,125.43585648638344],[11.61095725374821,125.43762680001106]],
                    label: "1.20 km St.Mary's COLLEGE", 
                    color: "black" 
                },
                { 
                    coords: [[11.6121582686395,125.433309249028],[11.6124867091316,125.433446987806],[11.6128805646471,125.433622291705],[11.6132267206834,125.433782290182],[11.6134638507464,125.433903332662],[11.6133916213818,125.434078636563]], 
                    label: "1.10 km SAVEMORE", 
                    color: "black" 
                }
            ]
        },
        {
            coords: [11.620310559317474, 125.43859755243164],
            title: "LOT-004",
            location: "Brgy Songco, Borongan City",
            area: "230 sq.m.",
            cost: "P4500.00",
            images: [
                'https://github.com/SmartPropertySolutionsESamar/easternsamarlotforsale/blob/main/images/pic1.png?raw=true',
                'https://github.com/SmartPropertySolutionsESamar/easternsamarlotforsale/blob/main/images/pic2.png?raw=true',
                'https://github.com/SmartPropertySolutionsESamar/easternsamarlotforsale/blob/main/images/pic3.png?raw=true',
                'https://github.com/SmartPropertySolutionsESamar/easternsamarlotforsale/blob/main/images/pic4.png?raw=true'
            ],
            videos: [
                'https://github.com/SmartPropertySolutionsESamar/easternsamarlotforsale/blob/main/images/github%20balud.mp4',
                'https://www.youtube.com/embed/WoNlC4ecuEk'
            ],
            routes: [
                { 
                    coords: [[11.6138320392987,125.430902101926],[11.6135038697128,125.430903584352],[11.613166261515,125.430947439031],[11.6127510665888,125.430974566962],[11.6123126197644,125.430994912815],[11.6117529346948,125.431052559279],[11.6114822261,125.431110205874],[11.6109275217777,125.431308577907],[11.6102897765266,125.431552728197],[11.6097533371024,125.431813832502],[11.6091537876692,125.432105456419],[11.6091023027541,125.432132584226],[11.6092052725738,125.432464899866],[11.6089345595133,125.432534408779],[11.6085907726925,125.432629356090],[11.6082586096292,125.432746342823],[11.6078234773642,125.432849767588],[11.6073999691028,125.432946409440],[11.6070777709978,125.433037965784]],
                    label: "0.83 km CITY CENTER", 
                    color: "black" 
                },
                { 
                    coords: [[11.6092052622285,125.432464898381],[11.6094427569903,125.43246659387],[11.6098230803488,125.432498808139],[11.6101357126716,125.432532535812],[11.6104529794108,125.432626691016],[11.6107075303699,125.432722729322],[11.6109915942101,125.432822533836],[11.6110561541331,125.432839481774],[11.61124061108,125.432378122805],[11.6114029329993,125.431941242665]],
                    label: "0.90 km HOSPITAL", 
                    color: "black" 
                },
                { 
                    coords: [[11.6110571053576,125.432840379724],[11.6116799178819,125.433100552971],[11.6121582696532,125.433309248347],[11.6121037566711,125.433448378425]],
                    label: "0.94 km MetroBANK", 
                    color: "black" 
                },
                { 
                    coords: [[11.609223161168458,125.43247807940111],[11.610411464791468,125.43585648638344],[11.61095725374821,125.43762680001106]],
                    label: "1.20 km St.Mary's COLLEGE", 
                    color: "black" 
                },
                { 
                    coords: [[11.6121582686395,125.433309249028],[11.6124867091316,125.433446987806],[11.6128805646471,125.433622291705],[11.6132267206834,125.433782290182],[11.6134638507464,125.433903332662],[11.6133916213818,125.434078636563]], 
                    label: "1.10 km SAVEMORE", 
                    color: "black" 
                }
            ]
        }
    ];

    // Add blinking markers to the map and store them
    markers.forEach(function(markerData) {
        // Create a blue pin with name (initially light blue)
        var bluePinIcon = createBluePinWithName(markerData.title, false);
        var marker = L.marker(markerData.coords, {
            title: markerData.title,
            icon: bluePinIcon
        }).addTo(myMap);

        // Store the marker and its data
        marker.markerData = markerData;
        propertyMarkers.push(marker);

        // Add click event
        marker.on('click', function() {
            // Update marker appearances
            updateMarkerAppearance(markerData);
            selectedMarker = markerData;
            
            // Show property panel
            showPropertyPanel(markerData);
            
            // Center map on marker
            myMap.setView(markerData.coords, 16);
        });
    });

    // Add measurement labels for LOT-001
    addManualMeasurements(manualMeasurements);
    myMap.on("zoomend", toggleManualMeasurements);

    // Global variables to track routes
    var currentLines = [];
    var currentRouteLabels = [];
    var routesVisible = true;

    // NEW ENHANCEMENT FUNCTIONS

    // Toggle contact options
    function toggleContactOptions() {
        const options = document.getElementById('contactOptions');
        options.style.display = options.style.display === 'block' ? 'none' : 'block';
    }

    // Close contact options when clicking elsewhere
    document.addEventListener('click', function(event) {
        const contactBtn = document.querySelector('.contact-btn');
        const contactOptions = document.getElementById('contactOptions');
        
        if (!contactBtn.contains(event.target) && !contactOptions.contains(event.target)) {
            contactOptions.style.display = 'none';
        }
    });

    // Enhanced showPropertyPanel function
    function showPropertyPanel(markerData) {
        const panel = document.getElementById('propertyPanel');
        const panelContent = document.getElementById('panelContent');
        
        // Add property features based on lot
        const propertyFeatures = {
            "LOT-001": ["Road Access", "Flat Terrain", "Water Source Nearby", "Good for Residential"],
            "LOT-002": ["Near Beach", "Commercial Area", "High Visibility"],
            "LOT-003": ["City Center", "Near Schools", "Commercial Potential"],
            "LOT-004": ["Quiet Area", "Residential Zone", "Growing Community"]
        };
        
        // Add estimated monthly payment
        const costNumber = parseFloat(markerData.cost.replace(/[^0-9.]/g, ''));
        const monthlyEstimate = (costNumber / 60).toFixed(2); // 5-year estimate
        
        panelContent.innerHTML = `
            <div class="property-header">
                <div class="property-title">${markerData.title}</div>
                <div class="status-available">AVAILABLE</div>
            </div>
            
            <div class="highlight-feature">
                <strong>üí∞ Estimated Monthly: P${monthlyEstimate} (60 months)</strong>
            </div>
            
            <div class="property-info">
                <p><strong>üìç Location:</strong> ${markerData.location}</p>
                <p><strong>üìê Area:</strong> ${markerData.area}</p>
                <p><strong>üíµ Total Cost:</strong> ${markerData.cost}</p>
                <p><strong>‚≠ê Features:</strong></p>
                <div class="property-features">
                    ${propertyFeatures[markerData.title].map(feature => 
                        `<span class="feature-badge">${feature}</span>`
                    ).join('')}
                </div>
            </div>
            
            <button class="tour-btn" onclick="startVirtualTour('${markerData.title}')">
                üè† Virtual Tour & 360¬∞ Views
            </button>
            
            <div class="action-buttons">
                <button class="action-btn primary" onclick="openInquiryForm('${markerData.title}')">
                    üìù Inquire Now
                </button>
                <button class="action-btn secondary" onclick="scheduleViewing('${markerData.title}')">
                    üìÖ Schedule Viewing
                </button>
            </div>
            
            <h4>üñºÔ∏è Property Images:</h4>
            <div class="property-images">
                ${markerData.images.map((image, index) => 
                    `<a href="${image}" data-lightbox="${markerData.title}" data-title="Image ${index + 1}">
                        <img src="${image}" alt="Image ${index + 1}">
                    </a>`
                ).join('')}
            </div>
            
            <h4>üé• Property Videos:</h4>
            <div class="property-videos">
                ${markerData.videos.map((video, index) => 
                    `<button class="video-btn" onclick="playVideo('${video}')">
                        ${index === 0 ? 'üöÅ Drone Overview' : 'üö∂‚Äç‚ôÇÔ∏è Walkthrough Tour'}
                    </button>`
                ).join('')}
            </div>
            
            <div class="urgency-note">
                <strong>‚è∞ Limited Availability!</strong> This property has high interest. Contact today!
            </div>
        `;
        
        panel.style.display = 'block';
        
        if (markerData.routes) {
            drawRoutes(markerData);
        }
    }

    // Contact functions
    function openInquiryForm(lotTitle) {
        const message = `Hi! I'm interested in ${lotTitle}. Please send me more details.`;
        const whatsappUrl = `https://wa.me/639564907947?text=${encodeURIComponent(message)}`;
        window.open(whatsappUrl, '_blank');
    }

    function scheduleViewing(lotTitle) {
        const message = `Hi! I'd like to schedule a viewing for ${lotTitle}. What times are available?`;
        const messengerUrl = `https://m.me/EsamarRealtor?text=${encodeURIComponent(message)}`;
        window.open(messengerUrl, '_blank');
    }

    // Function to start virtual tour
    function startVirtualTour(lotTitle) {
        console.log("Starting virtual tour for:", lotTitle);
        
        // Find the marker data for the selected lot
        const markerData = markers.find(marker => marker.title === lotTitle);
        
        if (!markerData) {
            console.error("Lot title not found:", lotTitle);
            return;
        }
        
        // Stop blinking for this specific marker
        stopBlinking(lotTitle);
        
        // Zoom to the polygon with very tight bounds (closer zoom)
        const polygon = lotPolygons[lotTitle];
        if (polygon) {
            const bounds = polygon.getBounds();
            
            // Use minimal padding for a very close zoom
            myMap.fitBounds(bounds, {
                paddingTopLeft: [10, 10],
                paddingBottomRight: [10, 10],
                maxZoom: 19 // Set a maximum zoom to prevent going too close
            });
        }
        
        // Add camera pins for virtual tour
        addCameraPins(lotTitle);
        
        // Show measurement labels
        toggleManualMeasurements();
        
        // Removed the alert popup - virtual tour starts silently
    }

    // Function to draw routes for a specific lot
    function drawRoutes(markerData) {
        // Clear any previous routes
        clearRoutes();
        
        if (markerData.routes) {
            // Draw multi-point lines and add distance labels at the last point of each route
            markerData.routes.forEach(function(route) {
                var polyline = L.polyline(route.coords, { 
                    color: route.color, 
                    dashArray: "5, 5"  // This makes the line dashed
                }).addTo(myMap);
                currentLines.push(polyline);

                var endLatLng = route.coords[route.coords.length - 1]; // Set the label at the end of the line
                var labelMarker = L.marker([endLatLng[0], endLatLng[1]], { 
                    icon: L.divIcon({
                        className: 'distance-label',
                        html: `<span style="color: ${route.color};">${route.label}</span>`, // Change text color to match the line color
                    })
                }).addTo(myMap);
                currentRouteLabels.push(labelMarker);
            });
        }
    }

    // Function to clear routes only
    function clearRoutes() {
        currentLines.forEach(function(line) {
            myMap.removeLayer(line);
        });
        currentLines = [];
        
        currentRouteLabels.forEach(function(label) {
            myMap.removeLayer(label);
        });
        currentRouteLabels = [];
    }

    // Function to close property panel
    function closePropertyPanel() {
        document.getElementById('propertyPanel').style.display = 'none';
        clearRoutes();
        clearCameraPins();
        // Reset all markers to blinking and light blue when panel is closed
        resetAllMarkers();
    }

    // Function to handle zoom changes and hide camera pins when zoomed out
    function handleZoomChange() {
        const newZoom = myMap.getZoom();
        currentZoomLevel = newZoom;
        
        // Hide camera pins when zoomed out beyond a certain level
        if (isVirtualTourActive && newZoom < 17) {
            activeCameraPins.forEach(pin => {
                if (myMap.hasLayer(pin)) {
                    myMap.removeLayer(pin);
                }
            });
        } 
        // Show camera pins when zoomed in during virtual tour
        else if (isVirtualTourActive && newZoom >= 17) {
            activeCameraPins.forEach(pin => {
                if (!myMap.hasLayer(pin)) {
                    myMap.addLayer(pin);
                }
            });
        }
        
        // Update measurement labels based on zoom
        toggleManualMeasurements();
    }

    // Listen for zoom events
    myMap.on('zoomend', handleZoomChange);

    // Open and close modal for 360¬∞ photos
    function openPanoramaModal(photoUrl) {
        if (photoUrl) {
            document.getElementById("panorama").innerHTML = `
                <iframe src="${photoUrl}" width="100%" height="100%" frameborder="0" allowfullscreen></iframe>
            `;
            document.getElementById("panoramaModal").style.display = "block";
        }
    }

    function closePanoramaModal() {
        document.getElementById("panoramaModal").style.display = "none";
        document.getElementById("panorama").innerHTML = "";
    }

    // Handle modal video player
    var modal = document.getElementById("videoModal");
    var videoFrame = document.getElementById("videoFrame");
    var closeModal = document.getElementsByClassName("close")[0];

    function playVideo(videoUrl) {
        modal.style.display = "block";
        videoFrame.src = videoUrl;
    }

    closeModal.onclick = function() {
        modal.style.display = "none";
        videoFrame.src = ""; // Stop the video when the modal is closed
    };

    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
            videoFrame.src = ""; // Stop the video when the modal is closed
        }
        if (event.target == document.getElementById("panoramaModal")) {
            closePanoramaModal();
        }
    };

    function zoomHome() {
        myMap.setView([11.6076, 125.4858], 13);
        closePropertyPanel();
    }

    // Handle window resize
    window.addEventListener('resize', function() {
        setTimeout(() => {
            myMap.invalidateSize();
        }, 100);
    });
</script>
</body>
</html>
